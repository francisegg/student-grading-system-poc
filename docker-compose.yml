version: '3.8'

services:
  # ==========================================
  # ğŸŸ¢ å”¯ä¸€çš„è³‡æ–™åº« (çœç©ºé–“ï¼)
  # ==========================================
  db:
    image: postgres:15-alpine
    container_name: shared_db
    restart: always
    environment:
      POSTGRES_USER: myuser
      POSTGRES_PASSWORD: mypassword
      POSTGRES_DB: shared_grades_db
    volumes:
      - shared_pg_data:/var/lib/postgresql/data

  # ==========================================
  # ğŸ”µ èª²ç¨‹ 1ï¼šé›»è·¯å­¸ (å­¸ç”Ÿå…¥å£)
  # ==========================================
  circuit:
    build: .
    container_name: app_circuit
    restart: always
    ports:
      - "127.0.0.1:8081:8080"
    environment:
      - DB_HOST=db
      - DB_NAME=shared_grades_db
      - APP_NAME=é›»è·¯å­¸æˆç¸¾ç¶²
      - APP_SUBJECT=circuit  # â˜… é—œéµï¼šæŒ‡å®šç§‘ç›®
      - TEACHER_WHITELIST=huangky.tw@gmail.com
      # Google OAuth è¨­å®š (Callback æŒ‡å‘ circuit.teaegg.space)
      - GOOGLE_REDIRECT_URL=https://circuit.teaegg.space/auth/callback
    depends_on:
      - db

  # ==========================================
  # ğŸŸ£ èª²ç¨‹ 2ï¼šå¤©ç·šå·¥ç¨‹ (å­¸ç”Ÿå…¥å£)
  # ==========================================
  antenna:
    build: .
    container_name: app_antenna
    restart: always
    ports:
      - "127.0.0.1:8082:8080"
    environment:
      - DB_HOST=db
      - DB_NAME=shared_grades_db
      - APP_NAME=å¤©ç·šå·¥ç¨‹æˆç¸¾ç¶²
      - APP_SUBJECT=antenna # â˜… é—œéµï¼šæŒ‡å®šç§‘ç›®
      - TEACHER_WHITELIST=huangky.tw@gmail.com
      # Google OAuth è¨­å®š (Callback æŒ‡å‘ antenna.teaegg.space)
      - GOOGLE_REDIRECT_URL=https://antenna.teaegg.space/auth/callback
    depends_on:
      - db

  # ==========================================
  # ğŸ”´ è€å¸«ç¸½å¾Œå° (ç¨ç«‹å…¥å£)
  # ==========================================
  admin-portal:
    build: .
    container_name: app_admin
    restart: always
    ports:
      - "127.0.0.1:8090:8080"
    environment:
      - DB_HOST=db
      - DB_NAME=shared_grades_db
      - APP_MODE=admin      # â˜… é—œéµï¼šç®¡ç†å“¡æ¨¡å¼
      - APP_NAME=æ•™å¸«ç¸½ç®¡ç†å¾Œå°
      - TEACHER_WHITELIST=huangky.tw@gmail.com
      # Google OAuth è¨­å®š (Callback æŒ‡å‘ admin.teaegg.space)
      - GOOGLE_REDIRECT_URL=https://admin.teaegg.space/auth/callback
    depends_on:
      - db

volumes:
  shared_pg_data: